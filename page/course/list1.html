<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>课程列表</title>
		<!-- 外部样式表 -->
		<link rel="stylesheet" href="../../iframe/dist/css/layui.css" media="all"/>
		
	</head>
	<body>
	<div style="width: 80%;margin-left: auto;margin-right: auto;margin-top: 50px;">
		
	<form class="layui-form" action="">
	  
	  <div class="layui-form-item">
	    <label class="layui-form-label">用户id</label>
	    <div class="layui-input-block">
	      <input type="text" name="id" placeholder="请输入用户id" autocomplete="off" class="layui-input">
	    </div>
	  </div>
	  
	  <div class="layui-form-item">
	    <div class="layui-input-block">
	      <button class="layui-btn" lay-submit lay-filter="search">全部查询</button>
	     
	    </div>
	  </div>
	</form>
	 
	 </div>
	 
	 <table id="user" lay-filter="userTable"> </table>
	 
	 
	 <a href="../score/list2.html">成绩</a>
	  <a href="../user/list.html">用户</a>
	   <a href="../course/list1.html">课程</a>
	   
	   
		
	   <script type="text/html" id="allBar">
		 <a class="layui-btn layui-btn-primary" lay-event="add">新增</a>
	     <a class="layui-btn layui-btn-primary" lay-event="update">修改</a>
	     <a class="layui-btn layui-btn-primary" lay-event="del">删除</a>
	   </script>
	    <!-- 行间的工具条模板 -->
		
	
	<script type="text/html" id="barUpdateDele">
	   <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="updateUser">修改</a>
	   <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="delUser">删除</a>
	 
    </script>
	 
	 
	 
	<script src="../../iframe/dist/layui.all.js"></script>
	<script >
		
		
	//Demo
	layui.use(['form','jquery','table'], function(){
	  var form = layui.form;
	  var $ = layui.jquery;
	  var table = layui.table;
	  
	  // 监听表格行间操作事件
	  table.on('tool(userTable)',function(obj){
		  
		  console.log(obj)
		  
		  if(obj.event == 'updateUser'){
			  layer.msg('修改');
			  layer.open({
			  	 title:'更改用户信息',
			     type:2, 
			  	 area:['100%','100%'],
			  	 content: './update.html?id='+obj.data.id
				 });
			  // location.href = './update.html?id='+obj.data.id;
			 
		  }else if(obj.event == 'delUser'){
			  layer.confirm('真的删除行:id:'+obj.data.id+'么？', function(index){
				delCourse(obj.data.id);
				var score={courseId:obj.data.id};
				del(score);
				obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
				layer.close(index);
				// location.reload();
				
				
				
			  });
			  
			  
		  }else{
			  layer.msg('未知事件')
		  }
		  
	  });
	  
	  
	  //监听表头按钮
	  table.on('toolbar(userTable)',function(data){
		  
		  var checkStatus = table.checkStatus(data.config.id);
		  
		  if(data.event == 'add'){
			  layer.open({
				title:'新增课程',
			    type:2, 
				area:['100%','100%'],
				end: function(index, layero){
					table.reload("courseTableId")
				},  
			    content: './add.html' //这里content是一个普通的String
			    //content: $('#addUserForm') //这里content是一个普通的String
				//<div id="tong" class="hide" style="width: 670px;height: 320px;display: none;">
			  });
		  }
		  if(data.event == 'update'){
			   if(checkStatus.data.length == 0) {
			         layer.msg('请选择一行');
			   } else if(checkStatus.data.length > 1) {
			         layer.msg('只能同时编辑一个');
			   } else{
				   // location.href = './update.html?id='+checkStatus.data[0].id;
				   layer.open({
				   	 title:'更改课程信息',
				     type:2, 
				   	 area:['100%','100%'],
					 content: './update.html?id='+checkStatus.data[0].id

					   end: function(index, layero){
						   table.reload("courseTableId")
					   },

				   });

			   }
			 
		  }
		  if(data.event == 'del'){
				if(checkStatus.data.length === 0) {
				      layer.msg('请选择一行',{time:2000});
				}else{
					
					var myString = "";
					for(i in checkStatus.data){
						myString=myString+JSON.stringify(checkStatus.data[i])+"";
						
					}
					if(confirm('确定要删除这些行么？'+myString)){
						
						for(i in checkStatus.data){
							delCourse(checkStatus.data[i].id);
						}
						// obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
						// layer.close(index);//向服务端发送删除指令
					}
				 //只有当点击confirm框的确定时，该层才会关闭
				// 	   // layer.close(index)
				// 	   // location.reload()
				// }
		  }
		  }
	  });

	  let tableHead = [[ //标题栏
	  			      {checkbox: true}
	  			     ,{field: 'id', title: 'ID', width: '5%'}
	  			     ,{field: 'name', title: '课程名', width: '8%'}
	  			     ,{field: 'teacherId', title: '教师id', width: '8%'}
	  			     ,{field: 'teacherName', title: '教师姓名', width: '8%'}
	  			     ,{field: 'college', title: '院系', width: '8%'}
	  			     ,{field: 'team', title: '学期', width: '8%'}
	  			     ,{field: 'updateTime', title: '更新时间', width: '8%'}
	  			     ,{field: 'createTime', title: '创建时间', width: '8%'}
	  			     ,{field: 'remark', title: '备份', width: '8%'}
	  			      ,{field: '', title: '操作',toolbar:'#barUpdateDele'}
	  			    ]];
	 
	 
	 table.render({
		 id:"courseTableId",
	 	elem:'#user',
	 	cols:  tableHead,
		url:'/api/course/search',
	 	toolbar: '#allBar' //开启头部工具栏，并为其绑定左侧模板
	     ,defaultToolbar: ['filter', 'exports', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
	 		title: '提示'
	         ,layEvent: 'LAYTABLE_TIPS'
	         ,icon: 'layui-icon-tips'
	       }]
	     ,title: '课程总表'
		 ,page:true
		 ,limit:10
		 // ,limit:[10,30,50,100]
		 ,request: {
		     pageName: 'page' //页码的参数名称，默认：page
		     ,limitName: 'rows' //每页数据量的参数名，默认：limit
		 }
		 ,response: {
		   statusName: 'code' //规定数据状态的字段名称，默认：code
		   ,statusCode: 200 //规定成功的状态码，默认：0
		   ,msgName: 'msg' //规定状态信息的字段名称，默认：msg
		   ,countName: 'total' //规定数据总数的字段名称，默认：count
		   ,dataName: 'data' //规定数据列表的字段名称，默认：data
		 } 
		//  ,parseData: function(res){ //res 即为原始返回的数据
		// 	console.log(JSON.stringify(res))
		// 	return {
		// 	  "code": res.code, //解析接口状态
		// 	  "msg": res.msg, //解析提示文本
		// 	  "count": res.total, //解析数据长度
		// 	  "data": res.data //解析数据列表
		// 	};
		// }
	 });
	 
	 
	 
	  

	 	
		
		
		// --   独立定义的方法
		
		function delCourse(id){

			// 查课程下是否有成绩
			// 有  就提示
			// 		确认 则删除
			//		取消 则退出
			// 无 就删除


				  $.ajax({
				  	url:'/api/course/del',
				  	data:{id:id},
				  	type:'POST',
				  	success:function(res){
							if(res && res.code == 200){
								layer.msg("courseId:"+id+"删除成功",{time:3000});
						        return 'a';
							}else{
							 layer.msg("courseId:"+id+"删除失败",{time:5000});	
							 console.log("courseId:"+id+"删除失败",{time:5000});
							 return 'b';
						    }
					},
					error:function(){
						layer.msg("courseId:"+id+"删除异常",{time:5000});	
						console.log("courseId:"+id+"删除异常",{time:5000});
						return 'b';
						
					}
				});
		}
		

		
		
	});
	
	

	</script>
	
	</body>
</html>
