<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>成绩列表</title>
		<!-- 外部样式表 -->
		<link rel="stylesheet" href="../../iframe/dist/css/layui.css" />
		
	</head>
	<body>
	<div style="width: 80%;margin-left: auto;margin-right: auto;margin-top: 50px;">
		
	<form class="layui-form" action="">
	  
	  <div class="layui-form-item">
	    <label class="layui-form-label">成绩id</label>
	    <div class="layui-input-block">
	      <input type="text" name="id" placeholder="请输入成绩id" autocomplete="off" class="layui-input">
	    </div>
	  </div>
	  
	  <div class="layui-form-item">
	    <div class="layui-input-block">
	      <button class="layui-btn" lay-submit lay-filter="search">全部查询</button>
	      <button class="layui-btn" lay-submit lay-filter="searchId">查询id</button>
	    </div>
	  </div>
	</form>
	 
	 </div>
	 
	 <table id="user" lay-filter="userTable"> </table>
	 
	 <script type="text/html" id="barUpdateDele">
	   <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="updateUser">修改</a>
	   <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="delUser">删除</a>
	 </script>
	 
	 
	 
	<script src="../../iframe/dist/layui.all.js"></script>
	<script >
		
		
	//Demo
	layui.use(['form','jquery','table'], function(){
	  var form = layui.form;
	  var $ = layui.jquery;
	  var table = layui.table;
	  
	  
	  table.on('tool(userTable)',function(obj){
		  
		  console.log(obj)
		  
		  if(obj.event == 'updateUser'){
			  layer.msg('修改',function(){
				  location.href = './update.html?id='+obj.data.id;
			  })
		  }else if(obj.event == 'delUser'){
			  function b(){
				  // user = obj.data;
				  delUser(obj.data.id);// user.id
			  }
			  layer.msg('删除');
			  b();
			  
		  }else{
			  layer.msg('未知事件')
		  }
		  
	  })
	  
	  

	  let tableHead = [[ //标题栏
	  			     {checkbox: true}
	  			     ,{field: 'id', title: 'ID', width: 80}
	  			     ,{field: 'courseId', title: '课程id', width: 120}
	  			     ,{field: 'score', title: '成绩', width: 120}
	  			     ,{field: 'studentId', title: '学生id', width: 120}
	  			     ,{field: 'updateTime', title: '更新时间', width: 120}
	  			     ,{field: 'createTime', title: '创建时间', width: 120}
	  			     ,{field: 'remark', title: '备份', width: 120}
	  			      ,{field: '', title: '操作', width: 320,toolbar:'#barUpdateDele'}
	  			    ]];
	 
	  //监听提交
	  form.on('submit(search)', function(data){
	    var formData = data.field;
		formData.page = 1;
		formData.rows = 30;
		
		
		
		
		$.ajax({
			url:'/api/score/search',
			data:formData,
			type:'POST',
			success:function(res){
			
				if(res && res.code == 200){
					layer.msg("查询成功");
					
					table.render({
						elem:'#user',
					  height: 300,
					  data:res.data,
					  cols:  tableHead
					});
					
				}else{
					layer.msg("查询失败");
				}
				   
				
				
			},
			error:function(){
				layer.msg("查询异常");
			}
		});
		
		
		
	    return false;
	  });
	  
	
	
	 form.on('submit(searchId)', function(){
	  var myid = $("input[name='id']").val();
	  
	  $.ajax({
	  	url:'/api/score/getById',
	  	data:{id:myid},
	  	type:'POST',
	    success:function(res){
	 			
	 				if(res && res.code == 200){
	 					layer.msg("查询成功");
	 					console.log("查询成功");
						console.log(JSON.stringify(res));
	 					table.render({
							elem:'#user',
							  height: 300,
							  data:[res.data],
							  cols:  tableHead
							});
	 					
	 				}else{
	 					layer.msg("查询失败");
	 				}
	 				   
	 				
	 				
	 			},
	 			error:function(){
	 				layer.msg("查询异常");
	 			}
	 		});
	 		
	 		
	 		
	   return false;
	 });
	 
	 	
		
		
		// --   独立定义的方法
		
		function delUser(id){
				  $.ajax({
				  	url:'/api/score/del',
				  	data:{id:id},
				  	type:'POST',
				  	success:function(res){
							if(res && res.code == 200){
								layer.msg("删除成功");
						    console.log(JSON.stringify(res));
								console.log("删除成功");
							}else{
							layer.msg("删除失败");
						    }
					},
					error:function(){
						layer.msg("删除异常");
					}
				});
		}
	});
	
	

	</script>
	</body>
</html>
